package com.kyanite.deeperdarker.datagen.data.loot;

import com.kyanite.deeperdarker.DeeperDarker;
import com.kyanite.deeperdarker.content.DDBlocks;
import com.kyanite.deeperdarker.content.DDEnchantments;
import com.kyanite.deeperdarker.content.DDItems;
import net.minecraft.data.loot.LootTableSubProvider;
import net.minecraft.resources.ResourceLocation;
import net.minecraft.world.item.Items;
import net.minecraft.world.item.alchemy.Potions;
import net.minecraft.world.level.block.Blocks;
import net.minecraft.world.level.storage.loot.LootPool;
import net.minecraft.world.level.storage.loot.LootTable;
import net.minecraft.world.level.storage.loot.entries.EmptyLootItem;
import net.minecraft.world.level.storage.loot.entries.LootItem;
import net.minecraft.world.level.storage.loot.functions.*;
import net.minecraft.world.level.storage.loot.providers.number.ConstantValue;
import net.minecraft.world.level.storage.loot.providers.number.UniformGenerator;
import org.jetbrains.annotations.NotNull;

import java.util.function.BiConsumer;

public class DDChestLoot implements LootTableSubProvider {
    public static final ResourceLocation ANCIENT_TEMPLE_BASEMENT = new ResourceLocation(DeeperDarker.MOD_ID, "chests/ancient_temple_basement");
    public static final ResourceLocation ANCIENT_TEMPLE_SECRET = new ResourceLocation(DeeperDarker.MOD_ID, "chests/ancient_temple_secret");

    @Override
    public void generate(@NotNull BiConsumer<ResourceLocation, LootTable.Builder> consumer) {
        consumer.accept(ANCIENT_TEMPLE_BASEMENT, LootTable.lootTable().withPool(LootPool.lootPool().setRolls(UniformGenerator.between(4, 6)).add(LootItem.lootTableItem(Blocks.SCULK).setWeight(32).apply(SetItemCountFunction.setCount(UniformGenerator.between(6, 8)))).add(LootItem.lootTableItem(Blocks.SOUL_SOIL).setWeight(31).apply(SetItemCountFunction.setCount(UniformGenerator.between(3, 7)))).add(LootItem.lootTableItem(DDItems.SOUL_DUST.get()).setWeight(31).apply(SetItemCountFunction.setCount(UniformGenerator.between(3, 7)))).add(LootItem.lootTableItem(Items.ECHO_SHARD).setWeight(30).apply(SetItemCountFunction.setCount(UniformGenerator.between(4, 7)))).add(LootItem.lootTableItem(DDItems.GRIME_BRICK.get()).setWeight(28).apply(SetItemCountFunction.setCount(UniformGenerator.between(5, 13)))).add(LootItem.lootTableItem(Items.NAME_TAG).setWeight(26)).add(LootItem.lootTableItem(DDItems.SCULK_BONE.get()).setWeight(25).apply(SetItemCountFunction.setCount(UniformGenerator.between(2, 7)))).add(LootItem.lootTableItem(Items.STRING).setWeight(20).apply(SetItemCountFunction.setCount(UniformGenerator.between(9, 16)))).add(LootItem.lootTableItem(DDBlocks.CRYSTALLIZED_AMBER.get()).setWeight(18).apply(SetItemCountFunction.setCount(UniformGenerator.between(2, 5)))).add(LootItem.lootTableItem(Items.IRON_INGOT).setWeight(16).apply(SetItemCountFunction.setCount(UniformGenerator.between(7, 14)))).add(LootItem.lootTableItem(Items.GOLD_INGOT).setWeight(13).apply(SetItemCountFunction.setCount(UniformGenerator.between(7, 12)))).add(LootItem.lootTableItem(Items.DIAMOND).setWeight(10).apply(SetItemCountFunction.setCount(UniformGenerator.between(3, 7)))).add(LootItem.lootTableItem(Items.BOOK).setWeight(8).apply(SetItemCountFunction.setCount(UniformGenerator.between(1, 2))).apply(EnchantRandomlyFunction.randomApplicableEnchantment())).add(LootItem.lootTableItem(Items.ENCHANTED_GOLDEN_APPLE).setWeight(3).apply(SetItemCountFunction.setCount(UniformGenerator.between(1, 2)))).add(LootItem.lootTableItem(Items.MUSIC_DISC_OTHERSIDE).setWeight(2)).add(LootItem.lootTableItem(Items.BOOK).setWeight(1).apply(EnchantRandomlyFunction.randomEnchantment().withEnchantment(DDEnchantments.CATALYSIS.get()))).add(LootItem.lootTableItem(DDItems.WARDEN_CARAPACE.get()).setWeight(1).apply(SetItemCountFunction.setCount(UniformGenerator.between(1, 2))))).withPool(LootPool.lootPool().setRolls(ConstantValue.exactly(2)).add(LootItem.lootTableItem(Items.POTION).setWeight(10).apply(SetPotionFunction.setPotion(Potions.STRONG_STRENGTH))).add(LootItem.lootTableItem(Items.IRON_LEGGINGS).setWeight(7).apply(EnchantWithLevelsFunction.enchantWithLevels(UniformGenerator.between(25, 35)).allowTreasure()).apply(SetItemDamageFunction.setDamage(UniformGenerator.between(0.2f, 0.5f)))).add(LootItem.lootTableItem(Items.IRON_SHOVEL).setWeight(7).apply(EnchantWithLevelsFunction.enchantWithLevels(UniformGenerator.between(15, 30))).apply(SetItemDamageFunction.setDamage(UniformGenerator.between(0.3f, 0.9f)))).add(LootItem.lootTableItem(Items.DIAMOND_BOOTS).setWeight(5).apply(EnchantWithLevelsFunction.enchantWithLevels(UniformGenerator.between(25, 40))).apply(SetItemDamageFunction.setDamage(UniformGenerator.between(0.1f, 0.2f)))).add(LootItem.lootTableItem(Items.IRON_HOE).setWeight(5).apply(EnchantWithLevelsFunction.enchantWithLevels(UniformGenerator.between(20, 40)))).add(LootItem.lootTableItem(Items.DIAMOND_SWORD).setWeight(4).apply(EnchantWithLevelsFunction.enchantWithLevels(UniformGenerator.between(30, 40)).allowTreasure()).apply(SetItemDamageFunction.setDamage(UniformGenerator.between(0.4f, 0.8f)))).add(LootItem.lootTableItem(Items.DIAMOND_HELMET).setWeight(3).apply(EnchantWithLevelsFunction.enchantWithLevels(UniformGenerator.between(35, 50)))).add(LootItem.lootTableItem(Items.DIAMOND_HOE).setWeight(3).apply(EnchantWithLevelsFunction.enchantWithLevels(UniformGenerator.between(30, 50))).apply(SetItemDamageFunction.setDamage(UniformGenerator.between(0.5f, 0.9f)))).add(LootItem.lootTableItem(Items.DIAMOND_LEGGINGS).setWeight(3).apply(EnchantWithLevelsFunction.enchantWithLevels(UniformGenerator.between(40, 50)).allowTreasure()).apply(SetItemDamageFunction.setDamage(UniformGenerator.between(0.15f, 0.4f)))).add(LootItem.lootTableItem(Items.DIAMOND_AXE).setWeight(2).apply(EnchantWithLevelsFunction.enchantWithLevels(UniformGenerator.between(40, 50)).allowTreasure()).apply(SetItemDamageFunction.setDamage(UniformGenerator.between(0.5f, 0.7f)))).add(LootItem.lootTableItem(Items.DIAMOND_CHESTPLATE).setWeight(2).apply(EnchantWithLevelsFunction.enchantWithLevels(UniformGenerator.between(40, 50)).allowTreasure()).apply(SetItemDamageFunction.setDamage(UniformGenerator.between(0.3f, 0.7f))))));
        consumer.accept(ANCIENT_TEMPLE_SECRET, LootTable.lootTable().withPool(LootPool.lootPool().setRolls(UniformGenerator.between(3, 6)).add(LootItem.lootTableItem(Blocks.COBWEB).setWeight(97).apply(SetItemCountFunction.setCount(UniformGenerator.between(1, 2)))).add(LootItem.lootTableItem(Items.ECHO_SHARD).setWeight(29).apply(SetItemCountFunction.setCount(UniformGenerator.between(1, 5)))).add(EmptyLootItem.emptyItem().setWeight(17)).add(LootItem.lootTableItem(Items.DIAMOND).setWeight(2).apply(SetItemCountFunction.setCount(UniformGenerator.between(2, 6))))).withPool(LootPool.lootPool().setRolls(ConstantValue.exactly(1)).add(LootItem.lootTableItem(DDItems.SCULK_TRANSMITTER.get()))));
    }
}
